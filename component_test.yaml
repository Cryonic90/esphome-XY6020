substitutions:
  tx_pin: "GPIO21"
  rx_pin: "GPIO20"
  
esphome:
  name: xy6020

external_components:
  - source: github://creepystefan/esphome-XY6020

esp32:
  board: esp32-c3-devkitm-1
  variant: esp32c3 

wifi:
  ssid: forsteramsee
  power_save_mode: none
  ap: {}
  #password: 
  #manual_ip:
  #  static_ip: !secret xy6020_IP
  #  gateway: !secret gateway
  #  subnet: !secret subnet

web_server:
  port: 80

captive_portal:

logger:
  level: DEBUG

modbus:
  send_wait_time: 1s
  uart_id: uart_bus1
  id: mod_bus

modbus_controller:
  - id: modbus_c
    address: 1
    modbus_id: mod_bus
    setup_priority: -10
    update_interval: 10s

uart:
  tx_pin: ${tx_pin}
  rx_pin: ${rx_pin}
  id: uart_bus1
  baud_rate: 115200
  stop_bits: 1
  parity: NONE
  debug:
    direction: BOTH
    dummy_receiver: true

sensor:
  - platform: xy6020
    seted_output_voltage:
      name: "Eingestellte Ausgangsspannung"
    seted_output_current:
      name: "Eingestellter Ausgangsstrom"
    input_voltage:
      name: "Eingangsspannung"
    output_voltage:
      name: "Ausgangsspannung"
    output_current:
      name: "Ausgangsstrom"
    output_power:
      name: "Ausgangsleistung"
    temperature_intern:
      name: "Temperatur intern"
    temperature_extern:
      name: "Temperatur intern"
    model:
      name: "Model"
    software_version:
      name: "Software Version"
 
  - platform: modbus_controller
    name: "Output AH low 16 bits"
    address: 0x06
    register_type: "holding"
    value_type: U_WORD
    unit_of_measurement: "mAH"
    accuracy_decimals: 2
    filters:
     - multiply: 0.01

  - platform: modbus_controller
    name: "Output AH high 16 bits"
    address: 0x07
    register_type: "holding"
    value_type: U_WORD
    unit_of_measurement: "mAH"
    accuracy_decimals: 2
    filters:
     - multiply: 0.01

  - platform: modbus_controller
    name: "Output WH low 16 bits"
    address: 0x08
    register_type: "holding"
    value_type: U_WORD
    unit_of_measurement: "mWH"
    accuracy_decimals: 2
    filters:
     - multiply: 0.01

  - platform: modbus_controller
    name: "Output WH low 16 bits"
    address: 0x09
    register_type: "holding"
    value_type: U_WORD
    unit_of_measurement: "mWH"
    accuracy_decimals: 2
    filters:
     - multiply: 0.01
  
  - platform: modbus_controller
    name: "Open Time Hours"
    address: 0x0A
    register_type: "holding"
    value_type: U_WORD
    unit_of_measurement: "Hours"
    accuracy_decimals: 0
    filters:
     - multiply: 1

  - platform: modbus_controller
    name: "Open Time Minutes"
    address: 0x0B
    register_type: "holding"
    value_type: U_WORD
    unit_of_measurement: "Minutes"
    accuracy_decimals: 0
    filters:
     - multiply: 1

  - platform: modbus_controller
    name: "Open Time Seconds"
    address: 0x0C
    register_type: "holding"
    value_type: U_WORD
    unit_of_measurement: "Seconds"
    accuracy_decimals: 0
    filters:
     - multiply: 1
  
  - platform: modbus_controller
    name: "M050"
    address: 0x50
    force_new_range: true
    register_type: "holding"
    value_type: U_WORD
    unit_of_measurement: "V"
    accuracy_decimals: 2
    filters:
     - multiply: 0.01

  - platform: modbus_controller
    name: "M051 Current Setting"
    address: 0x51
    register_type: "holding"
    value_type: U_WORD
    unit_of_measurement: "A"
    accuracy_decimals: 2
    filters:
     - multiply: 0.01

  - platform: modbus_controller
    name: "M052 Low Voltage Protected"
    address: 0x52
    register_type: "holding"
    value_type: U_WORD
    unit_of_measurement: "V"
    accuracy_decimals: 2
    filters:
     - multiply: 0.01

  - platform: modbus_controller
    name: "M053 Over Voltage Protected"
    address: 0x53
    register_type: "holding"
    value_type: U_WORD
    unit_of_measurement: "V"
    accuracy_decimals: 2
    filters:
     - multiply: 0.01
     
  - platform: modbus_controller
    name: "M054 Over Current Protect"
    address: 0x54
    register_type: "holding"
    value_type: U_WORD
    unit_of_measurement: "A"
    accuracy_decimals: 2
    filters:
     - multiply: 0.01

  - platform: modbus_controller
    name: "M055 Over Power Protected"
    address: 0x55
    register_type: "holding"
    value_type: U_WORD
    unit_of_measurement: "W"
    accuracy_decimals: 1
    filters:
     - multiply: 1.0

  - platform: modbus_controller
    name: "Maximum Output Time Hours"
    address: 0x56
    register_type: "holding"
    value_type: U_WORD
    unit_of_measurement: "Hours"
    accuracy_decimals: 2
    filters:
     - multiply: 0.01

  - platform: modbus_controller
    name: "M57"
    address: 0x57
    register_type: "holding"
    value_type: U_WORD
    unit_of_measurement: "V"
    accuracy_decimals: 2
    filters:
     - multiply: 0.01

  - platform: modbus_controller
    name: "M058"
    address: 0x58
    register_type: "holding"
    value_type: U_WORD
    unit_of_measurement: "V"
    accuracy_decimals: 2
    filters:
     - multiply: 0.01

  - platform: modbus_controller
    name: "M059"
    address: 0x59
    register_type: "holding"
    value_type: U_WORD
    unit_of_measurement: "V"
    accuracy_decimals: 2
    filters:
     - multiply: 0.01

  - platform: modbus_controller
    name: "Set Over Temperature Protected"
    address: 0x5C
    register_type: "holding"
    value_type: U_WORD
    unit_of_measurement: "Celsius"
    accuracy_decimals: 2
    filters:
     - multiply: 1.0

switch:
  - platform: modbus_controller
    modbus_controller_id: sdm
    name: "Tastensperre"
    id: keylockswitch
    register_type: holding
    address: 0x0F
    bitmask: 1
    entity_category: config
    icon: "mdi:toggle-switch"

  - platform: modbus_controller
    modbus_controller_id: sdm
    name: "EIN-AUS Schalter"
    id: onoff
    register_type: holding
    address: 0x12
    bitmask: 1
    entity_category: config
    icon: "mdi:toggle-switch"

  - platform: modbus_controller
    modbus_controller_id: sdm
    name: "Grad - Farendheit"
    register_type: holding
    address: 0x13
    bitmask: 1
    entity_category: config
    icon: "mdi:toggle-switch"
     
  - platform: modbus_controller
    modbus_controller_id: sdm
    name: "Sleep"
    register_type: holding
    address: 0x15
    bitmask: 1
    entity_category: config
    icon: "mdi:toggle-switch"

number:
  - platform: modbus_controller
    modbus_controller_id: sdm
    name: "Spannung Einstellen"
    mode: box
    address: 0x00
    unit_of_measurement: "Volt"
    min_value: 0
    max_value: 65
    step: 0.01
    value_type: U_WORD
    multiply: 100.0
      
  - platform: modbus_controller
    modbus_controller_id: sdm
    name: "Strom Einstellen"
    mode: box
    address: 0x01
    unit_of_measurement: "Ampere"
    min_value: 0
    max_value: 20
    step: 0.01
    value_type: U_WORD
    multiply: 100.0

  - platform: modbus_controller
    modbus_controller_id: sdm
    id: protectclear
    address: 0x10
    min_value: 0
    max_value: 1
    step: 1
    value_type: U_WORD

  - platform: modbus_controller
    modbus_controller_id: sdm
    name: "Low voltage protection value"
    mode: box
    address: 0x52
    unit_of_measurement: "Voltage"
    min_value: 0
    max_value: 70
    step: 0.1
    value_type: U_WORD
    multiply: 100.0
     
  - platform: modbus_controller
    modbus_controller_id: sdm
    name: "Overvoltage protection value"
    mode: box
    address: 0x53
    unit_of_measurement: "Voltage"
    min_value: 0
    max_value: 70
    step: 0.1
    value_type: U_WORD
    multiply: 100.0

  - platform: modbus_controller
    modbus_controller_id: sdm
    name: "Overcurrent protection value"
    address: 0x54
    unit_of_measurement: "Ampere"
    min_value: 0
    max_value: 21
    step: 0.01
    value_type: U_WORD
    multiply: 100.0

  - platform: modbus_controller
    modbus_controller_id: sdm
    name: "Over power protection value"
    address: 0x55
    unit_of_measurement: "Ampere"
    min_value: 0
    max_value: 1200
    step: 0.01
    value_type: U_WORD
    multiply: 100.0

  - platform: modbus_controller
    modbus_controller_id: sdm
    name: "Over Temperatur Protect Set"
    address: 0x5C
    unit_of_measurement: "Celsius"
    min_value: 0
    max_value: 95
    step: 1
    value_type: U_WORD
    multiply: 1
