#https://forum.openwb.de/viewtopic.php?t=6427
interval:
  - interval: 1s
    then:
      - http_request.get:
          url: http://${ichiIP}/cm?cmnd=status%2010 
          verify_ssl: false
          headers:
            Content-Type: application/json
          on_response:
            then:
              - lambda: |-
                  json::parse_json(id(getrequest).get_string(), [](JsonObject root) {
                      id(power1).publish_state(root["StatusSNS"]["ENERGY"]["POWER"]);
                      id(power2).publish_state(root["StatusSNS"]["POWER"]);
                      id(power3).publish_state(root["ENERGY"]["POWER"]);
                      id(power4).publish_state(root["StatusSNS"]["ENERGY"]["ApparentPower"]);
                      id(power5).publish_state(root["StatusSNS"]["ApparentPower"]);
                      id(power6).publish_state(root["ENERGY"]["ApparentPower"]);
                  });

http_request:
  useragent: esphome/device
  timeout: 5s
  id: getrequest

sensor:
  - platform: template
    name: power1
    id: power1
    
  - platform: template
    name: power2
    id: power2

  - platform: template
    name: power3
    id: power3

  - platform: template
    name: power4
    id: power4

  - platform: template
    name: power5
    id: power5

  - platform: template
    name: power6
    id: power6

